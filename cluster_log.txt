# first attempt at a script using hard-coded parameters and file paths.
# 10000 iterations (with setting to exit if no change for 1000)
# Logging every 20 iterations (a little too frequent) - logfile of best score and a set of factors (500 files)
# On HYDRA
module load libs/bioconductor/2.14/gcc-4.4.7+R-3.1.1
cd $SCRATCH/seqPredict
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N auto10k -b y -pe smp.pe 2 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.autoRun.R

# another run using 5 layers instead of one.  #layer 1 is still the target.layer. May just see dilution of signal and slowing of progression
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Layer5_10k -b y -pe smp.pe 2 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.autoRun.5_layer.R


#  awk '{ if($1 == "chr7" && $3 == "transcript") print $0 }' /mnt/genome-shared-data/bcf/genomeIndexes/hg19_GRCh37_random_chrM/annotation/gencode.v19.annotation.gtf > data/hg19.G19.chr7.transcript.gtf
#qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Layer5_chr7 -b y -pe smp.pe 8 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.chr7.R
# failed with core dump "memory not mapped"
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Layer5_chr7 -b y -pe smp.pe 16 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.chr7.R

# I added verbose as a parameter to several functions to get more detailed output.
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Lay5_chr7v -b y -pe smp.pe 16 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.chr7.verbose.R

# I also re-wrote modifyLayerByBindingFactor.multiHits() to use IRanges and speed up the layer modification, but it didn't make much difference.
# Kept failing even with 16 cores. No error messages despite using try()
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Lay5_chr7v -b y -pe smp.pe 32 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.chr7.verbose.R

# let's try a smaller chromosome
awk '{ if($1 == "chr22" && $3 == "transcript") print $0 }' /mnt/genome-shared-data/bcf/genomeIndexes/hg19_GRCh37_random_chrM/annotation/gencode.v19.annotation.gtf > data/hg19.G19.chr22.transcript.gtf
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Lay5_chr22v -b y -pe smp.pe 16 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/predictFromSequence.chr22.verbose.R


module load libs/bioconductor/2.14/gcc-4.4.7+R-3.1.1
qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Lay5_chr22v -b y -pe smp.pe 16 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/pfs.chr22.verbose.R

qsub -cwd -m e -M david.gerrard@manchester.ac.uk -V -N Lay5_chr22.1kb -b y -pe smp.pe 16 Rscript $SCRATCH/seqPredict/predictfromsequence/scripts/pfs.chr22.1kb.verbose.R



awk '{ if($1 == "chrM" && $3 == "transcript") print $0 }' /mnt/genome-shared-data/bcf/genomeIndexes/hg19_GRCh37_random_chrM/annotation/gencode.v19.annotation.gtf > data/hg19.G19.chrM.transcript.gtf